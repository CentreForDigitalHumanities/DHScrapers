services:
  harvest:
    image: dh-scrapers-openshift:latest
    user: "1000:0" # need this to check rootless
    volumes:
      - type: bind
        source: ./iis/harvest-metadata # mkdir harvest-metadata [or after autocreation] sudo chmod -R g+rwx ./harvest-metadata
        target: /harvest-metadata
      - type: bind
        source: ./iis/iis-files # mkdir iis-files [or after autocreation] sudo chmod -R g+rwx ./iis-files
        target: /iis-files
    command: /scripts/export-newest.sh
  # parse:
  #   image: ghcr.io/centrefordigitalhumanities/dh-scrapers:latest
  #   depends_on:
  #     harvest:
  #       condition: service_completed_successfully
  #   volumes:
  #     - iis-files/$JOB:/iis-files
  #     - type: bind
  #       source: $OUTPUT_FOLDER/$JOB
  #       target: /output
  #     - type: bind
  #       source: .
  #       target: /dh-scrapers/iis # this will not run in K8s because the directory is not present/filled with files in as in the local repo. it needs to be in the top level Dockerfile
  #   stdin_open: true
  #   tty: true
  #   command: python -m iis --import_folder /iis-files --export_folder /output --job_name $JOB